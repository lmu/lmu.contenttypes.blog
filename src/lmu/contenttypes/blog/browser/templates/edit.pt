<html xmlns="http://www.w3.org/1999/xhtml"
     xmln:metal="http://xml.zope.org/namespaces/metal"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="plone">

    <metal:block fill-slot="javascript_head_slot">
      <script type="text/javascript" tal:attributes="src string:${portal_url}/++resource++plone.app.imagecropping.static/jquery.Jcrop.min.js"></script>
      <script type="text/javascript" tal:attributes="src string:${portal_url}/++resource++plone.app.imagecropping.static/cropping.js"></script>
      <script type="text/javascript">
(function($) {
    var ajaxify_overlay_form = function() {
        $('.overlay form').ajaxForm({
            success: function () {
                $('.close a').click();
                $.ajax().done(
                    function(html) {
                        $(".previews").replaceWith($(html).find(".previews"));
                        set_up_functions();
                    }
                );
            }
        });
    };
    function set_up_functions() {
        $("a[href$='@@croppingeditor']").prepOverlay({
            subtype:'ajax',
            selector:'#content',
            closeselector:"input[name='form.button.Cancel']",
            width:'80%',
            config: {
                onLoad: ajaxify_overlay_form
            }
        });
        $("a[href$='@@edit'].popup").prepOverlay({
            subtype:'ajax',
            selector:'#content-core',
            closeselector:"input[name='form.buttons.cancel']",
            config: {
                onLoad: ajaxify_overlay_form
            }
        });
        $("a[href$='delete_confirmation'].popup").prepOverlay({
            subtype:'ajax',
            selector:'#content',
            closeselector:"input[name='form.button.Cancel']",
            config: {
                onLoad: ajaxify_overlay_form
            }
        });
        $("a.popup.image").prepOverlay({
            subtype:'image'
        });
        $('.itemorder').ajaxForm({
            success: function () {
                $.ajax().done(
                    function(html) {
                        $(".previews").replaceWith($(html).find(".previews"));
                        set_up_functions();
                    }
                );
            }
        });
    }
    $(function() {
        set_up_functions();
        // workaround this MSIE bug :
        // https://dev.plone.org/plone/ticket/10894
        if ($.browser.msie) $("#settings").remove();
        var Browser = {};
        Browser.onUploadComplete = function() {
            $.ajax().done(
                function(html) {
                    $(".previews").replaceWith($(html).find(".previews"));
                    set_up_functions();
                }
            );
        }
        loadUploader = function() {
            var ulContainer = $('.QuickUploadPortlet .uploaderContainer');
            ulContainer.each(function(){
                var uploadUrl =  $('.uploadUrl', this).val();
                var uploadData =  $('.uploadData', this).val();
                var UlDiv = $(this);
            $.ajax({
                type: 'GET',
                url: uploadUrl,
                data: uploadData,
                dataType: 'html',
                contentType: 'text/html; charset=utf-8',
                success: function(html) {
                    if (html.indexOf('quick-uploader') != -1) {
                        UlDiv.html(html);
                    }
                } });
            });
        }
    $(document).ready(loadUploader);

    })
})(jQuery);
      </script>
    </metal:block>

    <metal:block fill-slot="main">

        <a class="toogle button radius small right" href="#" data-reveal-id="rules" i18n:translate="" >Show Blog Rules</a>
        <h1 class="documentFirstHeading" tal:content="view/label | nothing" />
        <div id="rules" class="blog_info reveal-modal xlarge" data-reveal aria-labelledby="" aria-hidden="true" role="dialog" style="top: -8em;">
            <tal:rules tal:define="parent context/getParentNode;
                                   output parent/text/output"
                tal:content="structure output">
                Content Body
            </tal:rules>
            <a class="close-reveal-modal" aria-label="Close">&#215;</a>
        </div>
        <div id="content-core">
            <metal:block use-macro="context/@@ploneform-macros/titlelessform">
                <metal:block fill-slot="fields">
                    <metal:block use-macro="context/@@ploneform-macros/fields" />

                    <a href="#" tal:attributes="href string:${context/absolute_url}/@@croppingeditor">Bild zuschneiden</a>

                    <div id="form-widgets-quickupload-help"
                         class="formHelp reveal-modal xlarge"
                         data-reveal
                         aria-labelledby=""
                         aria-hidden="true"
                         role="dialog">
                        <div i18n:translate="" >
                            Please upload additional images or files.
                        </div>
                        <a class="close-reveal-modal" aria-label="Close">&#215;</a>
                    </div>
                    <div class="row field">
                        <div class="column small-12 medium-2">
                            <label for="" class="horizontal inline">
                                Upload additional Images and Files
                            </label>
                        </div>
                        <div class="column small-12 medium-10" >
                            <a class="toogle formHelpToggle inline right helper-margin-left-s"
                               href="#"
                               style="font-size: 2em;"
                               data-reveal-id="form-widgets-quickupload-help" >
                                <i class="fi-info"></i>
                                <span class="show-for-sr" i18n:translate="">Help</span>
                            </a>
                            <div tal:replace="structure view/render_quickupload"></div>
                            <div id="contens">
                                <div id="images" class="image-items">
                                    <ul class="content-previews">
                                        <li tal:repeat="img view/images">
                                            <a href="#" tal:attributes="href string:${img/url}/@@croppingeditor">
                                                <img src="${img/url}/@@images/image/thumb" tal:attributes="src string:${img/url}/@@images/image/thumb" />
                                             </a>
                                        </li>
                                    </ul>
                                </div>
                                <div id="files" class="content-items">
                                    <ul class="file-previews">
                                        <li tal:repeat="obj view/files">
                                            <img src="file_icon.png"/><span tal:content="obj/title">Title</span>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </metal:block>
            </metal:block>

            <div id="contents" class="row field">
                <div class="column small-12 medium-2">
                    <label class="horizontal inline">
                        Upload
                    </label>
                </div>
                <div class="column widget-column small-12 medium-10 large-10 end">
                    <a class="toogle formHelpToggle inline right helper-margin-left-s"
                    href="#"
                    style="font-size: 2em;"
                    data-reveal-id="upload-help">
                        <i class="fi-info"></i>
                        <span class="show-for-sr" i18n:translate="">Help</span>
                    </a>
                    <div class="column small-12">
                        <div tal:replace="structure view/render_quickupload"></div>
                    </div>
                    <div id="files" class="column small-12 content-items">
                        <ul class="image previews column small-6 large-8 small-block-grid-1 large-block-grid-3">
                            <li class="content-item" tal:repeat="item view/images">
                                <form class="itemorder" action="fc-itemOrder" method="post" tal:attributes="id string:functions-${item/id}">
                                    <input type="hidden" name="id" value="test.png" tal:attributes="value item/id" />
                                    <input type="hidden" name="subset_ids" value="['test.png']" tal:attributes="value view/subset_ids" />
                                    <span tal:replace="structure context/@@authenticator/authenticator"/>

                                    <ul class="functions column small-12">
                                        <metal:macro define-macro="common-functions">
                                        <li tal:condition="item/delta_up|nothing">
                                                <button type="submit" name="delta" value="1" tal:attributes="value item/delta_up">
                                                    <img src="arrowUp.png" alt="Up" title="Up">
                                                </button>
                                        </li>
                                        <li tal:condition="item/delta_down|nothing">
                                                <button type="submit" name="delta" value="-1" tal:attributes="value item/delta_down">
                                                    <img src="arrowDown.png" alt="Down" title="Down">
                                                </button>
                                        </li>
                                        <li>
                                            <a href="#" class="popup" tal:attributes="href string:${item/url}/@@edit">
                                                <img src="edit.png" alt="Edit" title="Edit">
                                            </a>
                                        </li>
                                        <li>
                                            <a href="#" class="popup" tal:attributes="href string:${item/url}/delete_confirmation">
                                                <img src="delete_icon.png" alt="Delete" title="Delete">
                                            </a>
                                        </li>
                                        </metal:macro>
                                        <li>
                                            <a href="#" class="popup image" tal:attributes="href string:${item/url}">
                                                <img src="image_icon.png" alt="View" title="View">
                                            </a>
                                        </li>
                                        <li>
                                            <a href="#" tal:attributes="href string:${item/url}/@@croppingeditor">
                                                <img src="cut_icon.png" alt="Crop" title="Crop">
                                            </a>
                                        </li>
                                        <!--
                                        <li>
                                            <a href="#" class="popup">Rotate</a>
                                        </li>
                                        -->
                                    </ul>
                                </form>
                                <img class="column small-12" src="${item/url}/@@images/image/teaser?_=${view/timestamp}" tal:attributes="src string:${item/url}/@@images/image/teaser?_=${view/timestamp}">
                                <span class="column small-12" tal:content="item/title">Bildtitel</span>
                            </li>
                        </ul>
                        <ul class="file previews column small-6 large-4">
                            <li class="row content-item" tal:repeat="item view/files">
                                <form class="itemorder" action="fc-itemOrder" method="post" tal:attributes="id string:functions-${item/id}">
                                    <input type="hidden" name="id" value="test.png" tal:attributes="value item/id" />
                                    <input type="hidden" name="subset_ids" value="['test.png']" tal:attributes="value view/subset_ids" />
                                    <span tal:replace="structure context/@@authenticator/authenticator"/>
                                    <ul class="functions column small-12">
                                        <metal:macro use-macro="template/macros/common-functions" />
                                        <li>
                                            <a href="#" tal:attributes="href string:${item/url}/@@download">
                                                <img src="file_icon.png" alt="Download" title="Download">
                                            </a>
                                        </li>
                                    </ul>
                                </form>
                                <div class="column small-12"><img src="file_icon.png"><span tal:content="item/title">Title</span></div>
                            </li>
                        </ul>
                    </div>
                </div>
                <div id="upload-help"
                    class="formHelp reveal-modal xlarge"
                    data-reveal
                    aria-labelledby=""
                    aria-hidden="true"
                    role="dialog">
                    <div i18n:translate="">
                    Zusätzliche Dateien und Bilder hoch laden
                    </div>
                    <a class="close-reveal-modal" aria-label="Close">&#215;</a>
                </div>
            </div>
        </div>

    </metal:block>

</html>
